<div class="page-header">        
            <div class="row">
                <div class="span12">
                    <div class="inner">
                        <h1 class="title">Email</h1>
                    </div>
                </div>
            </div>        
    </div>
    <div class="row">
        <form action="/email/453/" method="post" class="span12">
            
    
        <input id="csrf_token" name="csrf_token" type="hidden" value="20130123145752##5043488211c447f998d8f7ad9ab22cfc9d069a2b">
    

            <div class="form-actions">
                <button class="btn span2" style="position: absolute; top: -4000px;"><b>Save</b>
                </button>
                <button name="send" class="btn btn-danger span2" value="1"><i class="icon-white icon-warning-sign"></i><b>Send now</b></button>
                <button id="plan-button" type="button" class="btn btn-info span2" value="1"><i class="icon-white icon-time"></i> <b>Plan later </b></button>
                <button class="btn span2"><i class="icon icon-ok"></i> <b>Save</b></button>
                <button name="discard" class="btn span2" value="1"><i class="icon icon-remove"></i><b>Discard</b></button>
                <button name="test" class="btn btn-info span3" value="1"><i class="icon-user icon-white"></i><b>
    Send me test email
</b></button>
                
            </div>
            <div id="copy-group" class="row-fluid control-group hide">
                <div class="alert clearfix">
                    <div class="span2">
                        <label class="control-label">Copy from campaign</label>
                    </div>
                    <div class="span10">
                        <input type="text" class="span12" id="search"/>
                    </div>
                </div>
            </div>
            <div id="planned-execution-group"
                 class="row-fluid control-group ">
                <div class="alert clearfix">
                    <div class="span2">
                        <label class="control-label">Planned execution</label>
                    </div>
                    <div class="span4">
                        <input class="span12 datetimepicker" id="planned_execution" name="planned_execution" type="text" value="">
                        


                    </div>
                    <div class="span4">
                        <button name="plan" class="btn btn-danger span4" value="1"><i class="icon-white icon-time"></i>
                            <b>Plan it!</b></button>
                    </div>
                </div>
            </div>
            <div class="well clearfix">
                
    <div class="row-fluid control-group ">
        <div class="span1">
            <label class="control-label">From</label>
        </div>
        <div class="span5">
            <input class="span11" id="from_email" name="from_email" placeholder="From email" type="email" value="{{email.from}}">
            


        </div>
        <div class="span1">
            <label class="control-label">Name</label>
        </div>
        <div class="span5">
            <input class="span11" id="from_name" name="from_name" placeholder="From name" type="text" value="{{email.fromName}}">
            


        </div>
    </div >

                
                    
    <div class="row-fluid">
        <div class="span1">
            <label class="control-label">To</label>
        </div>
        <div class="span11" style="vertical-align: top;">
            <textarea id="customers" name="to" rows="1" style="width: 790px;">{{email.to}}</textarea>
            <a href="#myModal" role="button" data-toggle="modal" data-modalOverflow="auto" data-maxHeight="100px">Add filter</a>
        </div>
    </div>

                
                
    
    
        
            <div class="control-group ">
    <label class="control-label" for="subject"><span>Subject*</span></label>
    <div class="controls">
    <input class="span11" id="subject" name="subject" type="text" value="{{email.subject}}"> 


    
    </div>
</div>
        
    

    <div class="pull-right">
        <ul class="unstyled ul-horizontal">
            <li> <a href="/campaign/453/template/url/">Load from URL</a></li>
            <li>|</li>
            <li> <a href="/campaign/453/template/">Select template</a></li>
        </ul>
    </div>
    
    
        
            <div class="control-group ">
    <label class="control-label" for="wysiwyg"></label>
    <div class="controls">
        <label class="checkbox" for="wysiwyg">
            <input checked id="wysiwyg" name="wysiwyg" type="checkbox" value="y"> 
            <span>Use visual editor</span>
            


        </label>
        
    </div>
</div>
        
    

    
    
        
            <div class="control-group ">
    <label class="control-label" for="template"><span>Message*</span></label>
    <div class="controls">
    <textarea class="span11" id="template" name="template" rows="20">{{email.message}}</textarea> 


    
    </div>
</div>
        
    

    <div class="row-fluid">
        <div class="span1">
            <label class="control-label">Control group</label>
        </div>
        <div class="span11" style="vertical-align: top;">
            
    
        
            <div class="control-group ">
    <label class="control-label" for="control_group"><span>Control Group</span></label>
    <div class="controls">
    <input id="control_group" max="1" min="0" name="control_group" step="0.025" type="range" value="{{email.controlGroup}}"> 


    
        <p class="help-block">Messages are not sent to the control group. You can measure impact of the campaign.</p>
    
    </div>
</div>
        
    

            <script type="text/javascript">
                $(function(){
                    var value = $("<span>");
                    $("#control_group").on("change", function() {
                        value.html(Math.floor((parseFloat($(this).val()) * 1000))/10 + ' %');
                    }).after(value).change();
                });
            </script>
            


        </div>
    </div>
    <div class="row-fluid">
        <div class="span1">
            <label class="control-label">Purchase window</label>
        </div>
        <div class="span11" style="vertical-align: top;">
            <select id="window" name="window"><option selected value="7">1 week (default)</option><option value="14">2 weeks</option></select>
            


        </div>
    </div>

<!-- ---------------------------- Modal Dialogs --------------------------------- -->

<div id="myModal" class="modal container hide fade" tabindex="-1">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3>Add filter</h3>
  </div>
  <div class="modal-body clearfix">
    <div class="span3 clearfix">
        <h4>Filter by</h4>
        <form action="/email/475/customers/add-or/" method="post">
            <button class="btn btn-small" ng-click="AddOr()">OR</button>
        </form>        
        <ul class="nav nav-list">                
            <div ng-repeat="filtergroup in customerFilters">
                
            <li class="nav-header">{{filtergroup.group}}</li>                    

            <li ng-repeat="attribute in filtergroup.attributes">
                <a href="#editFilter" ng-click="SetCurrentFilter($parent.$index, $index);" data-toggle="modal">{{attribute.label}}</a>
            </li>
            </div>            
        </ul>
    </div>
    <div class="span9 clearfix">
        {{filterList}}
        <table class="table table-bordered table-condensed">
            <thead>
                <tr>
                    <th>Count</th>
                    <th>Cum<br/>count</th>
                    <th>Con<br/>count</th>
                    <th>Condition</th>
                    <th></th>
                </tr>
            </thead>
            <tbody ng-repeat="itemgroup in filterList"> 
                <tr ng-hide="$first">
                    <td colspan="5" style="text-align: center;">
                        OR
                        <div class="pull-right">
                            <form action="/email/475/customers/2/delete/"  class="btn-form" method="post">
                                <button class="btn"><i class="icon icon-remove"></i></button>
                            </form>
                        </div>
                    </td>
                </tr>       
                <tr ng-show="itemgroup.length > 0">
                    <td rowspan="{{itemgroup.length + 1}}"> 1</td>                                       
                </tr>                
                <tr  ng-repeat="item in itemgroup">                    
                    <td>
                        2
                    </td>
                    <td>
                        2
                    </td>
                    <td>
                        <a href="linka na editaciu filtra">
                            {{item.attribute.label}} {{item.operator}} {{item.value}}
                        </a>
                    </td>
                    <td>
                        <div class="pull-right">
                            <form action="/email/475/customers/0/delete/"  class="btn-form" method="post">
                                <button class="btn"><i class="icon icon-remove"></i></button>
                            </form>
                        </div>
                    </td>
                </tr>    

            </tbody>
            <tfoot>
                <tr>
                    <td colspan="5">Total: 2 customers</td>
                </tr>
            </tfoot>
        </table>

        <table class="table table-striped">
            <thead>
                <tr>
                    <th>External ID</th>
                    <th>Customer</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Excluded from campaigns</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><a href="/customer/686882/">
                            2
                    </a></td>
                    <td>
                        <a href="/customer/686882/">
                        
                            Bruney Brian
                        
                        </a>
                    </td>
                    <td>brian@7segments.com</td>
                    <td></td>
                    <td>
                        
                            <span class="label label-success">Included</span>
                        
                    </td>
                </tr>
                
                <tr>
                    <td><a href="/customer/686885/">
                        
                            5
                        
                    </a></td>
                    <td>
                        <a href="/customer/686885/">
                        
                            Clark Tony
                        
                        </a>
                    </td>
                    <td>tony@7segments.com</td>
                    <td>00421918666238</td>
                    <td>
                        
                            <span class="label label-success">Included</span>
                        
                    </td>
                </tr>
                
            </tbody>
        </table>        
    </div>
  </div>
  <div class="modal-footer">    
    <button class="btn btn-primary">OK</button>
  </div>
</div>

<div id="editFilter" class="modal hide fade" tabindex="-1">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3>Change filter: {{currentFilter.label}}</h3>
  </div>
  <div class="modal-body clearfix">
    <div class="span3 clearfix">
        <div class="control-group">
            <label class="control-label" for="operator"><span>Operator</span></label>
            <div class="controls">
                <select ng-model="currentFilterProperties.selectedOperator" ng-options="i for i in currentFilter.operators"></select>
            </div>            
        </div>
    </div>
    <div class="span3 clearfix">
        <div class="control-group ">
            <label class="control-label" for="value"><span>Value</span></label>
            <div class="controls">
                <input ng-model="currentFilterProperties.value" id="value" name="value" size="15" type="text" value="">             
            </div>
        </div>
    </div>
    <div class="clearfix">&nbsp;</div>
    <div class="modal-footer">
        <button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
        <button class="btn btn-primary" ng-click="AddFilter(currentFilter, currentFilterProperties.selectedOperator, currentFilterProperties.value)" data-dismiss="modal">Save</button>
    </div>
</div>

